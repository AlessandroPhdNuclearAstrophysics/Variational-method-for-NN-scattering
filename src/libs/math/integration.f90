FUNCTION B5(JB,M1,M2,M3,H1,H2,H3,A,IAS) RESULT(I5)
  IMPLICIT REAL*8(A-H,O-Z)
!       JB=1,2,3 PARA INTEGRAR EN 1,2,3 BLOQUES A PARTIR DEL PUNTO
!       DE ABCISAS IAS.
!       M1,M2,M3 NUMERO DE PASOS EN CADA BLOQUE, H1,H2,H3 PASO CORRES
!       PONDIENTE. HI=HI/22.5
!
  INTEGER, INTENT(IN) :: JB, IAS
  INTEGER, INTENT(IN) :: M1,M2,M3
  DOUBLE PRECISION, INTENT(IN) :: H1,H2,H3
  DOUBLE PRECISION, INTENT(IN) :: A(M1+M2+M3+3)
  DOUBLE PRECISION :: I5
!
  I5=0.D0
  N=M1
  H5=H1
  J0=IAS
  IR=JB-2
 1    IF(N-4) 44,2,2
 2    HL5=H5/32.D0
  NB=N/4
  N1=N-4*NB+1
  S2=0.D0
  S3=S2
  S4=S2
  L=J0
  DO 4 I=1,NB
    S2=S2+A(L+2)
    S3=S3+A(L+1)+A(L+3)
    S4=S4+A(L)+A(L+4)
 4  L=L+4
    GOTO (8,12,16,20),N1
 8  AX=0.D0
    GOTO 40
12  AX=HL5*(-19.D0*A(L-3)+106.D0*A(L-2)-264.D0*A(L-1)+646.D0*A(L)+ &
      251.D0*A(L+1))
    GOTO 40
16  AX=HL5*(-8.D0*A(L-2)+32.D0*A(L-1)+192.D0*A(L)+992.D0*A(L+1)+ &
      232.D0*A(L+2))
    GOTO 40
20  AX=HL5*(-27.D0*A(L-1)+378.D0*A(L)+648.D0*A(L+1)+918.D0*A(L+2)+ &
      243.D0*A(L+3))
40  I5=I5+AX+H5*(7.D0*S4+32.D0*S3+12.D0*S2)
    IF(IR) 60,50,55
50  J0=M1+IAS
    N=M2
    H5=H2
    IR=-1
    GOTO 1
55  J0=M2+M1+IAS
    N=M3
    H5=H3
    IR=0
    GOTO 1
60  RETURN
  !
44   WRITE(4,200)
200  FORMAT(//1X,'  NUMERO DE INTERVALOS MENOR QUE 4'/)
  STOP
END FUNCTION B5